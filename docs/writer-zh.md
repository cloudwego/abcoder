### `Write` 函数文档

---

#### 1. 函数签名

```go
func Write(ctx context.Context, repo *uniast.Repository, args WriteOptions) error
```

#### 2. 功能概述

`Write` 函数的核心职责是将 `uniast.Repository` 中表示的源代码（UAST）重新写回到文件系统中。它会遍历仓库（`repo`）中的所有模块，并为每个模块选择一个特定于语言的写入器（`Writer`），将抽象语法树（AST）转换并输出为格式化的源代码文件。

这个函数是代码生成或代码重构流程的最后一步，实现了从抽象表示到具体代码的转换。

#### 3. 参数说明

| 参数名 | 类型 | 说明 |
| :--- | :--- | :--- |
| `ctx` | `context.Context` | Go 标准上下文，用于控制超时和取消信号。 |
| `repo` | `*uniast.Repository` | 指向 `uniast.Repository` 实例的指针。该实例包含了整个代码仓库的 UAST 表示，包括所有模块、文件和符号信息。 |
| `args` | `WriteOptions` | 写入操作的配置选项。根据代码推断，它至少包含 `OutputDir`（代码输出目录）和 `Compiler`（特定语言可能需要的编译器或工具路径，例如 Go 的格式化工具）等字段。 |

#### 4. 执行流程

1.  **遍历模块**：函数首先会遍历 `repo.Modules` 中的每一个模块。
2.  **跳过外部模块**：通过调用 `m.IsExternal()` 方法，判断模块是否为外部依赖。如果是，则跳过该模块，只处理项目自身的源代码。
3.  **选择写入器（Writer）**：
    *   使用 `switch m.Language` 语句，根据模块的语言（`uniast.Language`）来选择合适的写入器。
    *   在当前实现中，仅支持 `uniast.Golang`。如果模块语言是 Go，它会创建一个 `golang/writer` 中的 `Writer` 实例。
    *   如果遇到任何其他不支持的语言，函数会立即返回一个错误。
4.  **写入模块**：
    *   调用所选写入器的 `WriteModule` 方法。
    *   该方法负责将此模块下的所有文件和目录结构，根据 UAST 的描述，在 `args.OutputDir` 指定的目录下生成对应的源代码文件。
5.  **错误处理**：在写入过程中，如果任何步骤（如创建文件、写入内容等）失败，`WriteModule` 会返回一个错误，`Write` 函数会立即将该错误向上传递并终止执行。
6.  **成功返回**：如果所有模块都成功写入，函数最终返回 `nil`。

#### 5. 当前限制

-   **语言支持**：目前的实现**仅支持 Go 语言**的代码生成。对于其他语言的模块，函数会直接报错。若要支持新语言，需要在 `switch` 语句中添加新的 `case` 并实现对应的 `uniast.Writer` 接口。