---
name: ABCoder: Review
description: Comprehensive validation of SCHEDULE.md to identify missing critical information (dependencies, typos, incomplete requirements) and assist in refinement.
category: ABCoder
tags: [abcoder, review, validation, quality]
---
从SCHEDULE.md中，使用mcp__abcoder进行全面验证，以识别缺失的关键信息（依赖、拼写错误、不完整的功能）并协助完善SCHEDULE文档。


<!-- ABCODER:START -->

## Guardrails

- **严格检查完整性**：系统性地检查所有关键信息，不遗漏任何依赖、字段或逻辑细节
- **证据驱动**：所有问题必须有明确的证据来源（需求文档、demo代码、SCHEDULE对比）
- **分类分级**：将发现的问题按严重程度分级（P0/P1/P2），优先修复关键问题
- **建设性建议**：不仅是指出问题，还要提供具体的修正建议和代码示例
- **禁止修改SCHEDULE**：Review阶段只输出问题和建议，不直接修改SCHEDULE文档
- **保存Review记录**：将Review意见保存到 `./task/{{MMDD}}/{{NAME}}__TO_BE_COMFIRMED.md`
   - 使用 `d=$(date +%m%d)` 获取当前日期（如 0127）
   - NAME 使用清晰的需求名称（如：添加用户认证、优化查询性能等）
   - 使用 `mkdir -p ./task/${d}` 确保目录存在
- **发起用户确认**：将 `./task/{{MMDD}}/{{NAME}}__TO_BE_COMFIRMED.md` 和 `./task/{{MMDD}}/{{NAME}}__SCHEDULE.md` 中待用户确认的问题收集整理，转化为claude code交互式选项，逐个和用户确认(注意不要遗漏)，根据用户确认结果更新SCHEDULE文档

## 关键要求

### 检查维度

必须系统性地检查以下8个维度：

1. **依赖完整性检查**（🔴 最高优先级）
   - 扫描需求文档中所有demo代码的import语句
   - 检查SCHEDULE的"三方库依赖"部分是否包含所有import
   - 区分依赖类型：新增外部SDK、内部工具库、标准库
   - 验证依赖格式：是否包含库名、是否已引入、引入方式、使用位置

2. **API设计一致性检查**
   - 检查需求文档中定义的API路径是否与SCHEDULE一致
   - 检查拼写错误（如resouce vs resource）
   - 检查请求/响应字段是否完整（特别是被demo代码使用的字段）
   - 检查分页参数、过滤参数是否齐全

3. **数据来源明确性检查**
   - 检查每个数据字段的来源是否明确说明
   - 特别关注：biz_domain、owners、src_region、dst_region等
   - 检查是否说明从哪个模型/方法的哪个字段获取

4. **核心逻辑完整性检查**
   - 检查关键算法逻辑是否有三种场景的完整覆盖
   - 检查边界条件处理是否说明
   - 检查聚合逻辑的条件判断是否完整（如VDC迁移的三种情况）

5. **任务规格完整性检查**
   - 检查每个任务的输入/输出规格是否明确
   - 检查验证方式是否包含build（必需）
   - 检查三方依赖是否在每个任务中列出
   - 检查涉及文件是否有具体路径和行号

6. **代码模式复用检查**
   - 检查是否复用了项目现有的代码模式
   - 检查参考的代码位置是否准确（行号是否正确）
   - 检查是否引入了不必要的改动

7. **配置和初始化检查**
   - 检查数据库集合名定义是否明确
   - 检查外部SDK的初始化参数是否完整
   - 检查定时任务的启动时机和执行时间是否明确

8. **待确认问题合理性检查**
   - 检查待确认问题是否都是无法自行决策的问题
   - 检查是否遗漏了需要澄清的关键决策点
   - 检查是否可以从现有代码/配置中直接推断的答案

### 输出格式要求

审查报告必须采用以下结构：

```markdown
# SCHEDULE.md 审查报告

## 📊 总体评分
- **需求覆盖度**：⭐⭐⭐⭐⭐ X/5
- **技术可行性**：⭐⭐⭐⭐⭐ X/5
- **依赖完整性**：⭐⭐⭐⭐⭐ X/5
- **任务规格**：⭐⭐⭐⭐⭐ X/5
- **文档完整性**：⭐⭐⭐⭐⭐ X/5
- **综合评分**：⭐⭐⭐⭐⭐ X/5

---

## 🔴 P0 级问题（必须修复）

### 问题1：[问题标题]
**严重程度**：🔴 P0
**影响范围**：[影响哪些任务/阶段]

**问题描述**：
[详细说明问题]

**证据来源**：
- 需求文档：requirement.md:XXX行
- SCHEDULE.md：line XXX

**修正建议**：
[具体的修正建议，包含代码示例]

---

## 🟡 P1 级问题（强烈建议修复）

### 问题1：[问题标题]
**严重程度**：🟡 P1
**影响范围**：[影响哪些任务/阶段]

[问题描述、证据来源、修正建议]

---

## 🟢 P2 级问题（可选优化）

### 问题1：[问题标题]
**严重程度**：🟢 P2

[问题描述、证据来源、修正建议]

---

## 📋 问题汇总统计

| 问题级别 | 数量 | 问题列表 |
|---------|-----|---------|
| P0（必须修复）| X | 1. xxx, 2. xxx |
| P1（强烈建议）| X | 1. xxx, 2. xxx |
| P2（可选优化）| X | 1. xxx |

---

## ✅ 完成度检查清单

### 依赖完整性
- [ ] 扫描了需求文档中所有demo代码的import语句
- [ ] 验证了每个import是否在SCHEDULE中声明
- [ ] 区分了依赖类型（外部SDK/内部工具库/标准库）
- [ ] 每个依赖包含了使用位置信息

### API设计一致性
- [ ] API路径拼写正确（无resouce等拼写错误）
- [ ] 请求/响应字段完整
- [ ] 分页参数齐全

### 数据来源明确性
- [ ] 每个数据字段来源明确
- [ ] 模型字段映射清晰

### 核心逻辑完整性
- [ ] 算法场景覆盖完整
- [ ] 边界条件处理说明
- [ ] 条件判断逻辑明确

### 任务规格完整性
- [ ] 输入/输出规格明确
- [ ] 验证方式包含build
- [ ] 涉及文件有具体路径和行号
- [ ] 三方依赖已列出

### 代码模式复用
- [ ] 复用了现有代码模式
- [ ] 参考位置准确
- [ ] 避免不必要改动

### 配置和初始化
- [ ] MongoDB集合名明确
- [ ] Metrics SDK参数完整
- [ ] 定时任务时机明确

### 待确认问题合理性
- [ ] 问题是真正的决策点
- [ ] 没有遗漏关键澄清点
- [ ] 可以从现有配置推断的已标注

---

## 🎯 修正优先级建议

### 立即修正（Review阶段）
- [ ] 修复所有P0级问题
- [ ] 补充所有P1级问题的修正方案

### 进入开发前
- [ ] 与用户确认P1/P2问题的修正方案
- [ ] 更新SCHEDULE.md文档
- [ ] 再次执行Review确保无遗漏

---

## 📚 参考信息

### 检查的文件
- **需求文档**：[path]
- **SCHEDULE文档**：[path]
- **参考代码**：[列出检查的代码文件]

### 使用的工具
- `Grep` - 搜索依赖使用
- `Read` - 读取需求文档和SCHEDULE
- 正则表达式 - 提取import语句
```

## 执行步骤

按以下顺序执行：

### Step 1: 依赖完整性检查（🔴 最高优先级）
1. **扫描需求文档中的import语句**
   - 使用正则表达式：`^\s*import\s+.*"(.*?)"`
   - 提取所有import路径
   - 记录每个import在demo代码中的使用位置

2. **验证SCHEDULE中的依赖声明**
   - 定位"三方库依赖"部分（通常在line 208附近）
   - 逐个对比import列表与SCHEDULE中的依赖清单
   - 标记缺失的依赖

3. **分类和验证依赖**
   - 使用Grep搜索每个依赖在目标仓库中的存在性
   - 分类为：新增外部SDK / 内部工具库 / 标准库
   - 检查格式是否包含：库名、是否已引入、引入方式、使用位置

4. **输出P0问题**
   - 对每个缺失或格式不正确的依赖
   - 提供完整的修正建议（包含表格格式示例）

### Step 2: API设计一致性检查
1. **检查API路径**
   - 从需求文档提取API路径定义（如POST /api/resource/:project_id/list）
   - 与SCHEDULE中的路由注册代码对比
   - 使用拼写检查工具识别常见的路径拼写错误

2. **检查请求/响应字段**
   - 从需求文档的Request/Response Schema中提取所有字段
   - 与SCHEDULE中的API模型定义对比
   - 检查demo代码使用的字段是否在模型中存在

3. **输出P0/P1问题**
   - 列出所有不一致的API定义
   - 提供修正的代码示例

### Step 3: 数据来源明确性检查
1. **识别关键数据字段**
   - 从需求文档的数据模型示例提取字段（psm、service_type、biz_domain、owners等）

2. **追踪字段来源**
   - 检查SCHEDULE中是否说明每个字段从哪里获取
   - 验证是否使用了正确的模型字段（如Item.OwnerList）

3. **输出P1问题**
   - 列出来源不明确的字段
   - 提供明确的来源说明建议

### Step 4: 核心逻辑完整性检查
1. **检查条件判断逻辑**
   - 识别VDC聚合、迁移判断等关键逻辑
   - 检查是否覆盖了所有场景（三种VDC迁移情况）

2. **检查边界条件处理**
   - 检查是否处理了空值、零值、早期数据等边界情况

3. **输出P1问题**
   - 列出逻辑不完整的场景
   - 提供完整的逻辑实现建议

### Step 5: 任务规格完整性检查
1. **检查每个任务的规格**
   - 逐一检查Phase 1/2/3中的所有任务
   - 验证每个任务是否包含：描述、前置依赖、输入规格、输出规格、涉及文件、关键函数/类、验证方式、三方依赖

2. **输出P1/P2问题**
   - 列出规格不完整的任务
   - 提供完整的规格模板

### Step 6: 代码模式复用检查
1. **验证参考代码位置**
   - 检查SCHEDULE中引用的代码路径和行号是否准确
   - 使用Read工具验证关键代码是否存在

2. **输出P2问题**
   - 列出不准确的引用
   - 提供修正的位置信息

### Step 7: 配置和初始化检查
1. **检查配置项完整性**
   - 验证MongoDB集合名定义
   - 验证Metrics SDK初始化参数
   - 验证定时任务配置

2. **输出P1问题**
   - 列出不完整的配置信息
   - 提供完整的配置建议

### Step 8: 待确认问题合理性检查
1. **分析待确认问题**
   - 评估每个问题是否真的是无法决策
   - 检查是否可以从现有代码/配置中推断答案

2. **输出P1问题**
   - 列出可以自行解决的问题
   - 提供从代码中获取答案的建议方法

### Step 9: 生成综合报告
1. **汇总所有问题**
   - 按严重程度分类（P0/P1/P2）
   - 统计问题数量
   - 计算总体评分

2. **输出完整报告**
   - 使用标准的审查报告格式
   - 确保每个问题都有明确的证据来源和修正建议
   - 提供修正优先级建议

### Step 10: 质量检查清单确认
1. **逐项检查完成度**
   - 使用输出格式要求中的检查清单
   - 标记每个检查项的完成状态

2. **输出最终结论**
   - 总结SCHEDULE的整体质量
   - 明确建议进入开发前必须完成的工作

## Reference

### 检查工具
- **正则表达式** - 提取import语句：`^\s*import\s+.*"(.*?)"`
- **拼写检查** - 识别typo（如resouce → resource）
- **Grep** - 验证依赖存在性：`Grep(pattern, path)`
- **Read** - 验证代码位置准确性

### 常见问题模式

| 问题类型 | 典型表现 | 优先级 |
|---------|-----------|--------|
| 遗漏内部工具库 | 需求demo中使用的工具库未在依赖中声明 | 🔴 P0 |
| API路径拼写错误 | 关键词拼写错误 | 🔴 P0 |
| 请求字段缺失 | demo使用的字段未在模型中定义 | 🟡 P1 |
| 数据来源不明确 | 字段来源未说明从哪个模型字段获取 | 🟡 P1 |
| 逻辑场景不完整 | 条件判断逻辑未覆盖所有场景 | 🟡 P1 |
| 配置信息缺失 | SDK初始化参数、集合名等配置不完整 | 🟡 P1 |
| 参考位置错误 | 引用的代码行号不准确 | 🟢 P2 |

### 审查示例

**示例1：内部工具库依赖遗漏检查**
```markdown
### 问题1：遗漏内部工具库依赖
**严重程度**：🔴 P0
**影响范围**：Metrics客户端扩展任务

**问题描述**：
需求文档的demo代码中使用了内部工具库函数计算数值，但SCHEDULE.md的"三方库依赖"部分未声明该依赖。

**证据来源**：
- 需求文档：demo代码中使用了工具库函数
- SCHEDULE.md：三方库依赖部分未包含该库
- 代码库验证：已在使用该库（通过Grep确认）

**修正建议**：
在SCHEDULE.md的"三方库依赖"部分添加该依赖，并标注：
- 类型：内部工具库
- 是否已引入：是
- 引入方式：import "..."
- 使用位置：说明在哪个任务中使用

同时在对应任务的"三方依赖"字段中添加：
- 工具库名（已引入）
```

**示例2：API路径拼写错误检查**
```markdown
### 问题2：API路径拼写错误
**严重程度**：🔴 P0
**影响范围**：HTTP路由注册

**问题描述**：
SCHEDULE.md的API路径中存在拼写错误，需求文档中也存在相同错误。

**证据来源**：
- 需求文档：定义的API路径包含拼写错误
- SCHEDULE.md："接口实现"部分引用该路径
- SCHEDULE.md：HTTP路由注册代码

**修正建议**：
1. 修正SCHEDULE.md中的路径拼写
2. 修正需求文档中的路径拼写
3. 在任务中明确正确的路由定义

路由注册代码示例：
```go
api.POST("正确的路径路径", handler)
```
```

## 使用方式

```bash
# 在SCHEDULE生成完成后执行review
/abcoder:review @task/0127/resource_usage_statistics__SCHEDULE.md

# 如果需要指定需求文档路径
/abcoder:review @task/0127/resource_usage_statistics__SCHEDULE.md --requirement ./requirement.md
```

---

<!-- ABCODER:END -->
